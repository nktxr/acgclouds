#!/bin/bash
export CREDS=$(aws sts assume-role \
 --role-arn arn:aws:iam::<TARGET_ACCOUNT_ID>:role/cfst-1449-541fd77cce761f8966998d2e7bb529-LambdaRole-znPfLGKhRzTG \
 --role-session-name githubactions-session \
 --query 'Credentials.[AccessKeyId,SecretAccessKey,SessionToken]' \
 --output text)
          # Use the credentials as needed...
# Create the .aws directory - won't fail if it already exists
mkdir -p .aws

# Create the AWS credentials file
cat > .aws/credentials <<EOL
[default]
aws_access_key_id=${AWS_ACCESS_KEY_ID}
aws_secret_access_key=${AWS_SECRET_ACCESS_KEY}
aws_session_token=${AWS_SESSION_TOKEN}
EOL

# Create the AWS config file to set the default region
cat > .aws/config <<EOL
[default]
region=us-east-1
EOL

echo "AWS credentials have been set up successfully."